## 테스트 코드를 짜는 이유

### 리팩토링과 테스트 코드

- 개발자가 작성한 코드의 기능이 외부 요인에 의해 변함없이 유지되도록 분석, 설계
- 코드를 수정할 때에도 다양한 검증을 거쳐 리팩토링
- 최대한 리팩토링을 해서 수정 전과 100% 동일하게 돌아가도록 보장될까? 확신할 수 없음
    - 동일하게 돌아가는지 검증하는 방법이 바로 테스트 코드!

### 리팩토링의 리스크 
- 리팩토링을 거치며 예상치 못하게 생길 수 있는 버그의 가능성
- 수정해서 다른 모듈에 영향을 줄 수 있는 사이드 이펙트의 가능성
    - 리스크 때문에 개발자가 기존 코드 수정을 꺼릴 수 있음
    - 이는 코드 수정에 대한 막연한 두려움과 방어적인 태도를 유발하여, 클린 코드를 유지하는 데 필요한 지속적인 개선을 어렵게 만들 수 있다.
    
### 테스트 코드의 장점
- 잘 작성된 테스트 코드는 이러한 두려움을 가장 효과적으로 제거할 수 있다.
    - 신규 기능 추가나 변경사항으로 인해 코드를 수정하는 경우, 잘 짜여진 테스트 코드가 있다면 테스트 실행 결과를 통해 버그, 오류를 빠르게 발견하여 수정할 수 있다.
- 협업 측면에서도 잘 짜여진 테스트 코드는 함께 일하는 다른 개발자들에게도 이 코드가 기능 오류 없이 잘 돌아간다는 확신을 심어줄 수 있다.
- 기존 코드의 기능을 검증하는 테스트 코드가 프로젝트 내부에서 점점 늘어갈수록, 프로젝트 전반의 `테스트 커버리지`가 높아져 전체적인 안정성이 향상된다. 


## 테스트 코드
자바, 코틀린: JUnit
스위프트: Swift Testing / XCTests, XCUITests (옛날 방식)

```책에서는 자바 + JUnit 기준으로 설명```


안드로이드도 자바 기반 코드로 돼있어서, 안드로이드에서는 두 가지 방식으로 테스트 코드 짜서 돌려본 적이 있음

1. test (JVM 환경에서 테스트): 안드로이드 관련 함수, 속성 같은 게 없는 순수한 자바 코드로 되어 있는 비즈니스 로직을 검증할 때 썼음
2. androidTest (안드로이드 환경에서 테스트): 안드로이드에서 쓰이는 함수, 속성이 하나라도 들어가있을 때 실제 기기 또는 에뮬레이터에 현재 앱을 설치 및 실행하고 테스트 코드를 그 안에서 돌릴 떄 썼음 
 
 
## 테스트 코드를 클린 코드로 작성하기

시스템을 유지보수하거나 시스템에 기능을 추가할 때 테스트 코드도 함께 수정해야 함
그런데, 테스트 코드에 코드 스멜이 많다면? 수정하기 번거로울 것
따라서 테스트 코드도 원래 코드처럼 가독성을 좋게 유지할 필요가 있음

1. 테스트 소스파일 이름, 함수 이름을 의도가 명확하게 드러나게 짓기
- 일반적인 테스트 코드 파일명은 ```\(테스트 대상 파일 이름)Test.\(소스 확장자)```
- 테스트 함수명은 함수의 역할과 작성 의도를 충분히 잘 드러내도록 지을 것

2. 테스트 코드 내부는 Given - When - Then 구조로 작성하기
- Given: 테스트 조건에 부합하도록 초기 상태 설정
- When: 테스트 코드 실행, 실행 결과값 반환
- Then: 반환된 결과값과 기댓값을 대조하여 테스트 성공/실패 여부 가리기

3. 각 테스트 함수는 assert() 함수를 최소로 사용하기
- 테스트 함수는 반드시 하나의 검증 결과를 내야 함 (단일 책임 원칙처럼)
- 먼저 어떤 환경을 설정하는 과정이 길고 복잡하다면, @BeforeAll 어노테이션이 붙은 메서드를 원래 실행하고자 하는 테스트 함수 이전에 실행시키는 방법도 있음

4. 커버리지를 고려한 테스트 코드 작성하기

```
커버리지: 작성한 테스트 코드가 실제로 구현 코드를 얼마나 실행하는지를 백분율로 나타내는 지표로, 테스트 코드가 구현 코드의 기능을 얼마나 검증했는지를 의미함
``` 


커버리지에는 어떤 기능의 성공, 실패, 예외 케이스를 모두 포함한다.
- 따라서, 발생할 수 있는 모든 상황에 대한 테스트를 진행하는 코드가 프로젝트 내부에 많이 있을수록 커버리지가 높은 프로젝트라고 할 수 있다.


### 라인 커버리지

```
테스트를 실행할 때 실제로 실행된 구현 코드의 라인 수와 전체 구현 코드의 라인 수를 나눈 비율
(테스트 코드가 실행한 구현 코드의 라인 수) / (전체 구현 코드의 라인 수)
```


테스트 코드가 전체 코드 중 얼머나 많은 코드를 검증하고 있는지를 보여주는 지표로, 구현 코드를 활용해 테스트 코드의 품질을 개선하는 데 유용한 개념이다.


### 잘 동작하는 테스트 코드 작성하기

```
테스트를 독립적으로 수행할 수 있고, 항상 동일한 테스트 결과를 보장하는 코드
``` 


- 테스트 코드 중에는 특정 환경이 반드시 필요한 것도 있고, 현재 시간대나 서버의 상태와 같은 환경적인 요인으로 인해 테스트 코드의 결과가 달라지는 것도 있다.
- 잘 동작하는 테스트 코드를 작성하려면, 이러한 변수들을 최대한 배제하고 Mock 라이브러리와 같은 것들을 활용해서 특정 환경을 가정하여 작성해야 한다.

```
모든 테스트 함수는 독립적으로 실행되어야 하니까, 그런 이유에서 Swift Testing에서 제공하는 @Test 함수들이 병렬적으로 순서 상관없이 실행되는 걸까?
```


### CI/CD 환경에서 테스트 코드 활용하기

1. Git에 변경사항 커밋, 푸시
2. CI (Continuous Integration) : Git 저장소에서 변경사항을 감지하면 이를 반영하여 자동으로 빌드하고 테스트 수행
3. CD (Continuous Deployment) : CI 단계에서 테스트를 모두 통과하면 자동으로 배포 

CI/CD 도구에는 대표적으로 Github Action, Jenkins가 있다...
CI/CD 워크플로에 테스트 코드를 포함할 수 있으며, 잘 작성된 CI/CD 환경의 테스트 코드를 통해 배포하기 전에 최종적으로 장애 가능성이 있는 코드를 미리 발견하고 수정할 수 있도록 여지를 둠 


```
CI/CD 환경에서 잘 작성된 테스트 코드는 개발자들에게 최후의 보루이자 듬직한 검사원과 같다.
```
